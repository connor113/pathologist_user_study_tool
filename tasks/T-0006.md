# tasks/T-0006.md — Admin Dashboard (≤3 hours)

**Goal:** Create admin web interface to monitor study progress, view pathologist completion stats, and download CSV export of all events; admin authenticates with same login flow but sees dashboard instead of viewer.

**AC:**
- Admin login uses same `/api/auth/login` endpoint; role check redirects admin users to dashboard instead of viewer
- Dashboard page displays at `/admin` route (or inline conditional render based on user role)
- Dashboard shows table of all pathologists with columns: username, total sessions started, completed sessions, completion percentage
- Dashboard shows overall study stats: total pathologists, total slides, total possible sessions (pathologists × slides), completed sessions, overall progress percentage
- "Download CSV" button calls `GET /api/admin/export/csv` and triggers browser download
- CSV filename includes date: `pathology_events_YYYY-MM-DD.csv`
- Dashboard auto-refreshes stats on page load (no real-time updates needed; admin can refresh browser)
- Logout button returns to login page
- Dashboard is responsive (works on laptop screens, no mobile optimization needed)

**Constraints:**
- Reuse existing login page/component; role-based routing decides which view to show
- Admin dashboard can be inline HTML (no separate route/SPA needed) or use simple show/hide based on `user.role`
- Use same API helpers from T-0005 (fetch with credentials)
- No user creation UI (admin creates users via backend script or direct API calls with curl/Postman)
- CSV export reuses backend endpoint already implemented in `backend/src/routes/admin.ts`

**Test notes:**
- Create test admin account in database: `INSERT INTO users (username, password_hash, role) VALUES ('admin', '$2b$10$...', 'admin');`
- Login as admin → should see dashboard, not viewer
- Login as pathologist → should see viewer, not dashboard
- Dashboard stats should match database queries (verify counts)
- CSV export should download file with all events from all users
- Test with 2 pathologists completing 3 slides each → dashboard shows "6/6 completed (100%)"

**Deliverables:**
- `src/admin/dashboard.ts` - Admin dashboard logic (fetch stats, handle CSV download) OR integrate into `src/viewer/main.ts` with role check
- `index.html` - Add admin dashboard HTML section (show/hide based on role) OR create separate `admin.html` page
- `src/admin/types.ts` - TypeScript interfaces for admin API responses (UserStats, ProgressStats) OR add to `src/viewer/types.ts`
- Update `src/viewer/main.ts` - Add role-based routing after login (if integrated approach)
- CSS styling for dashboard table and stats cards (can be inline in `index.html` or separate `admin.css`)

**Optional Enhancements (if time permits):**
- "Create User" form in dashboard (calls `POST /api/admin/users`)
- Per-user CSV export option (filter events by user_id)
- Visual progress bar for overall completion percentage
- Sortable table columns (click to sort by username, completion rate, etc.)

