# tasks/T-0005.md — Frontend Multi-User Refactor (≤4 hours)

**Goal:** Refactor existing V1 viewer to support multi-user authentication, slide queue navigation, and event batching to backend API; remove CSV export; add login UI and progress indicator.

**AC:**
- Login page displays on app load if not authenticated; username/password fields with submit button
- Successful login redirects to viewer; invalid credentials show error message
- Logout button added to viewer UI; clears session and returns to login
- After login, app fetches slide list from `/api/slides`; displays first incomplete slide automatically
- Progress indicator shows "Slide X of 200" at top of viewer
- "Confirm & Next" button uploads remaining events, marks session complete with label, loads next slide
- If all slides completed, show "Study Complete" message instead of loading slide
- Events batched every 10 interactions; uploaded to `/api/sessions/:sessionId/events` via POST
- On page load, check authentication via `/api/auth/me`; redirect to login if 401 response
- Session created via `/api/slides/:slideId/start` when slide first loads; session_id stored in memory
- Slide order randomized per user (backend handles deterministic shuffle)
- Removed: CSV export button, hardcoded `user_id = 'user_01'` placeholder

**Constraints:**
- Use `fetch()` with `credentials: 'include'` for all API calls (sends httpOnly cookie)
- API base URL from environment variable: `import.meta.env.VITE_API_URL` (defaults to `http://localhost:3001`)
- Minimal UI changes to existing viewer; login page can be inline HTML (no separate route needed)
- Error handling: network failures display user-friendly messages; log errors to console
- No state persistence in localStorage (rely on backend session tracking)

**Test notes:**
- Test with backend running locally (T-0004 complete)
- Create 2 test pathologist accounts with different usernames
- Login as User A → verify slide order; login as User B → verify different slide order
- Complete 3 slides as User A → logout → login again → verify resumes at slide 4
- Monitor network tab: events uploaded every 10 interactions + on slide complete
- Test label validation: try "Confirm & Next" without selecting label → shows error

**Deliverables:**
- `src/viewer/main.ts` - Updated with API integration, slide queue, session management
- `src/viewer/types.ts` - Add `User`, `Slide`, `Session` interfaces
- `src/viewer/SessionManager.ts` - New module: session creation, event batching, upload logic
- `src/viewer/SlideQueue.ts` - New module: fetch slides, track current index, load next slide
- `index.html` - Add login UI (show/hide based on auth state), progress indicator, logout button
- `.env.example` - Frontend env var template (VITE_API_URL)
- Updated: Remove CSV export button and download logic from `main.ts`


